<%-
def flag2config(flag, option, defval=true)
    case flag
    when true
        if defval
            ''
        else
            " #{option}=true"
        end
    when false
        if defval
            " #{option}=false"
        else
            ''
        end
    else
        ''
    end
end
-%>
# This file is managed by Puppet and local changes
# may be overwritten

# This file may be automatically generated by an installation program.

# By default, Docker uses a loopback-mounted sparse file in
# /var/lib/docker.  The loopback makes it slower, and there are some
# restrictive defaults, such as 100GB max storage.

# If your installation did not set a custom storage for Docker, you
# may do it below.

# Example: Use a custom pair of raw logical volumes (one for metadata,
# one for data).
# DOCKER_STORAGE_OPTIONS = --storage-opt dm.metadatadev=/dev/mylogvol/my-docker-metadata --storage-opt dm.datadev=/dev/mylogvol/my-docker-data

DOCKER_STORAGE_OPTIONS="<% -%>
<% if @storage_driver -%>
 --storage-driver=<%= @storage_driver %>
<%-     if @storage_driver == 'devicemapper' -%>
<%-         if @dm_basesize %> --storage-opt dm.basesize=<%= @dm_basesize %><% end -%>
<%-         if @dm_fs %> --storage-opt dm.fs=<%= @dm_fs %><% end -%>
<%-         if @dm_mkfsarg %> --storage-opt "dm.mkfsarg=<%= @dm_mkfsarg %>"<% end -%>
<%-         if @dm_mountopt %> --storage-opt dm.mountopt=<%= @dm_mountopt %><% end -%>
<%-         if @dm_blocksize %> --storage-opt dm.blocksize=<%= @dm_blocksize %><% end -%>
<%-         if @dm_loopdatasize %> --storage-opt dm.loopdatasize=<%= @dm_loopdatasize %><% end -%>
<%-         if @dm_loopmetadatasize %> --storage-opt dm.loopmetadatasize=<%= @dm_loopmetadatasize %><% end -%>
<%-         if @dm_thinpooldev %> --storage-opt dm.thinpooldev=<%= @dm_thinpooldev -%>
<%-         else -%>
<%-             if @dm_datadev %> --storage-opt dm.datadev=<%= @dm_datadev %><% end -%>
<%-             if @dm_metadatadev %> --storage-opt dm.metadatadev=<%= @dm_metadatadev %><% end -%>
<%-         end -%>
<%= flag2config(@dm_use_deferred_removal, '--storage-opt dm.use_deferred_removal', false) -%>
<%= flag2config(@dm_use_deferred_deletion, '--storage-opt dm.use_deferred_deletion', false) -%>
<%= flag2config(@dm_blkdiscard, '--storage-opt dm.blkdiscard') -%>
<%= flag2config(@dm_override_udev_sync_check, '--storage-opt dm.override_udev_sync_check', false) -%>
<%      elsif @storage_driver == 'overlay2' -%>
<%= flag2config(@overlay2_override_kernel_check, '--storage-opt overlay2.override_kernel_check', false) -%>
<%-     end -%>
<% end -%>
"